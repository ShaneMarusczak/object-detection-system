# ==============================================================================
# V1 WITH PHOTO DIGESTS
# ==============================================================================
# Same as V1, but enhanced with:
# - Daily email digests summarizing activity
# - Photos captured when events occur
# - AWS-style composition: just say you want a photo digest, the system
#   automatically enables json_log and frame_capture
# ==============================================================================

detection:
  model_file: "yolo11n.pt"
  track_classes: []  # Auto-derived from events
  confidence_threshold: 0.25


roi:
  horizontal:
    enabled: true
    crop_from_left_pct: 0
    crop_to_right_pct: 45
  vertical:
    enabled: true
    crop_from_top_pct: 5
    crop_to_bottom_pct: 95


# ==============================================================================
# GEOMETRY
# ==============================================================================
lines:
  - type: vertical
    position_pct: 25
    description: "traffic boundary"
    allowed_classes: [2, 3, 5, 7]


# ==============================================================================
# EVENTS - Now with email digests!
# ==============================================================================
events:
  # Daily summary of all vehicle crossings with photos
  - name: "vehicle-traffic-cross"
    match:
      event_type: "LINE_CROSS"
      line: "traffic boundary"
      object_class: ["car", "motorcycle", "bus", "truck"]
    actions:
      email_digest: "daily_traffic"
      # That's it! The system automatically enables:
      # - json_log (digest reads from JSON)
      # - frame_capture (digest has photos: true)


# ==============================================================================
# DIGESTS - Configure your daily summaries
# ==============================================================================
digests:
  - id: "daily_traffic"
    period_minutes: 1440  # 24 hours
    period_label: "Daily Traffic Summary"
    photos: true  # Include photos in digest

    # Frame capture settings for this digest
    frame_config:
      cooldown_seconds: 300  # One photo per vehicle per 5 minutes


# ==============================================================================
# FRAME STORAGE
# ==============================================================================
# Where to store captured frames
frame_storage:
  type: "local"
  local_dir: "frames"

  # For S3 storage:
  # type: "s3"
  # s3:
  #   bucket: "my-traffic-monitoring"
  #   region: "us-east-1"
  #   presigned_url_expires: 604800  # 7 days


# Temp frame buffer (required for frame capture)
temp_frames_enabled: true
temp_frame_dir: "/tmp/frames"
temp_frame_interval: 5
temp_frame_max_age_seconds: 30


# ==============================================================================
# OUTPUT
# ==============================================================================
output:
  json_dir: "data"


console_output:
  enabled: true
  level: "detailed"


consumers:
  json_writer:
    enabled: true
    prompt_save: true


# ==============================================================================
# EMAIL CONFIGURATION
# ==============================================================================
notifications:
  enabled: true

  email:
    enabled: true
    smtp_server: "smtp.gmail.com"
    smtp_port: 587
    use_tls: true
    username: "your-email@gmail.com"
    password: "your-app-password"  # Generate at https://myaccount.google.com/apppasswords
    from_address: "your-email@gmail.com"
    to_addresses:
      - "your-email@gmail.com"


camera:
  url: "http://192.168.86.33:4747/video"


runtime:
  default_duration_hours: 1.0
  queue_size: 1000
  analyzer_startup_delay: 1
  detector_shutdown_timeout: 5
  analyzer_shutdown_timeout: 10


speed_calculation:
  enabled: false


# ==============================================================================
# WHAT HAPPENS
# ==============================================================================
# 1. System runs, detecting vehicles crossing the traffic boundary
# 2. Each crossing is logged to JSON and a frame is captured
# 3. At the end of each 24-hour period, you receive an email:
#
#    Subject: Object Detection Digest: Daily Traffic Summary
#
#    Activity Summary - Daily Traffic Summary
#    ==================================================
#
#    Total Events: 47
#
#    Events by Object:
#      car: 35
#      truck: 8
#      motorcycle: 4
#
#    Line Crossings:
#      traffic boundary: 47 crossings
#
#    Captured Frames:
#    ==================================================
#
#    traffic boundary:
#      2025-12-22T08:15:32Z - car (LINE_CROSS)
#      Photo: https://s3.amazonaws.com/.../frame_123.jpg
#
#      2025-12-22T09:42:18Z - truck (LINE_CROSS)
#      Photo: https://s3.amazonaws.com/.../frame_456.jpg
#      ...
# ==============================================================================
